# UPTP (Universal P2P Transport Protocol)

UPTP 是一个基于 libp2p 和 Kademlia DHT 的 P2P 网络穿透工具，利用 IPv6 的全球唯一性，实现了无需 DDNS 的内网服务映射功能。

## 项目特点

- 基于 libp2p 的 P2P 网络实现
- 使用 Kademlia DHT 进行节点发现和路由
- 利用 IPv6 全球唯一地址，避免传统 DDNS 方案

## 技术架构

### 1. 网络架构
```
[Gateway内网服务] <-> [Gateway] <--P2P连接--> [Agent] <-> [外部访问]
```

### 2. 核心组件
- **P2P 引擎**：基于 libp2p 实现，支持 IPv6 和 Kademlia DHT
- **端口映射**：实现内网服务的 P2P 映射
- **资源管理**：管理端口映射资源

### 3. 技术特点
- 去中心化节点发现
- 自动地址管理

## 工作原理

1. **节点发现**
   - 使用 Kademlia DHT 进行节点发现
   - 自动维护节点路由表
   - 支持引导节点配置

2. **连接建立**
   - 基于 IPv6 建立 P2P 连接
   - 自动处理地址变化

3. **端口映射**
   - Gateway 管理映射资源
   - Agent 建立本地监听
   - 通过 P2P 连接转发流量

## 优势

1. **技术优势**
   - 去中心化架构
   - 自动地址管理
   - 高效节点发现

2. **运维优势**
   - 无需维护 DNS
   - 自动适应变化
   - 降低运维成本

3. **成本优势**
   - 无需域名费用
   - 无需 DDNS 服务
   - 降低运营成本

## 应用场景

1. **动态 IP 环境**
   - 家庭网络
   - 移动网络
   - 企业网络

2. **分布式应用**
   - 点对点通信
   - 分布式存储
   - 去中心化服务

3. **网络穿透**
   - 内网服务暴露
   - 远程访问
   - 跨网络通信

## 快速使用

### 1. 启动方式
```bash
# Gateway 端启动（试用模式）
./uptpgw -trial -v

# Agent 端配置示例（app.json）
{
    "res_id": 666666,
    "peer_id": "12D3KooWKuwm865AfwV2KCGQspvst3NugpbdK516m96ierff3B",
    "network": "tcp",
    "local_ip": "127.0.0.1",
    "local_port": 3388,
    "target_addr": "192.168.x.x",
    "target_port": 3389
}
# Agent 端启动
./uptp-agent -v
```

### 2. 使用说明
1. **Gateway 端**：
   - 使用 `-trial` 参数启动
   - 无需预先配置资源
   - 自动接受资源 ID 为 666666 的连接请求

2. **Agent 端**：
   - 配置资源 ID 为 666666
   - 指定目标地址和端口
   - 建立本地监听

### 3. 注意事项
- 试用模式仅建议在测试环境使用
- 日常使用应避免使用试用模式


## 日常使用 （待续）

### gateway端安装、资源配置
### agent端应用配置